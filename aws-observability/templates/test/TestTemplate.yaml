---
Global:
  TemplatePath: "../sumologic_observability.master.template.yaml"
  TestProjectName: MasterTemplate
  ParallelTestsRun: 7
  GlobalParameters:
    Section1eSumoLogicResourceRemoveOnDeleteStack: 'true'
    Section2aAccountAlias: 'testenv'
Tests:
  - TestName: defaultparameters
    Regions:
      - ap-south-1
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us1'
        Section1bSumoLogicAccessID: '${ENTERPRISE_US1_ACCESS_ID}'
        Section1cSumoLogicAccessKey: '${ENTERPRISE_US1_ACCESS_KEY}'
        Section1dSumoLogicOrganizationId: '${US1_ENTERPRISE_ORG_ID}'
        Section2aAccountAlias: 'test1env'
        Section4bMetricsNameSpaces: 'AWS/ApiGateway, AWS/DynamoDB, AWS/ElastiCache'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - AutoEnableOptions
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CommonCloudTrail
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - CreateCommonResources.CloudWatchMetricsFirstStack
            - CreateCommonResources.CloudWatchMetricsSecondStack
            - CreateCommonResources.CloudWatchMetricsFirstStack.SecondCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsFirstStack.ThirdCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsSecondStack.SecondCloudwatchMetricsSource
            - CreateCommonResources.ALBSource
            - CreateCommonResources.ALBSNSSubscription
            - CreateCommonResources.CloudTrailSource
            - CreateCommonResources.CloudTrailSNSSubscription
            - CreateCommonResources.CloudWatchEventFunction
            - CreateCommonResources.CloudWatchHTTPSource
            - RootCauseAppStack.RootCauseRole
            - RootCauseAppStack.SumoLogicHostedCollector
            - RootCauseAppStack.InventorySource
            - RootCauseAppStack.XraySource
            - CreateCommonResources.CloudWatchEventFunction.SumoCWDeadLetterQueue
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEmailSNSTopic
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEventsInvokeLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaExecutionRole
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogGroup
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogSubsriptionFilter
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQScheduleRule
            - CreateCommonResources.CloudWatchEventFunction.SumoCWSpilloverAlarm
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsInvokePermission
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsRuleTrigger
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.ExistingAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.SumoLambdaRole
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoCWLambdaInvokePermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTrigger
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTriggerPermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorRole
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoEC2MetricsAppStack.sumoApp
            - sumoEC2MetricsAppStack.sumoOverview
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoAlbMetricsAppStack.sumoApp
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoDynamoDBMetricsAppStack.sumoApp
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoRdsMetricsAppStack.sumoApp
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoApiGatewayMetricsAppStack.sumoApp
            - RootCauseAppStack.sumoOverview
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.sumoApp
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
            - sumoAlbMetricsAppStack.AlbLogsFieldExtractionRule
            - sumoApiGatewayMetricsAppStack.FieldExtractionRule
            - sumoDynamoDBMetricsAppStack.FieldExtractionRule
            - sumoLambdaMetricsAppStack.LambdaCloudWatchLogsFieldExtractionRule
            - sumoRdsMetricsAppStack.FieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
            - CreateCommonResources.CloudWatchLambdaARN
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambdaArn
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test1env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'Yes'
            CloudWatchMetricsSourceName: 'test1env-cloudwatch-metrics-ap-south-1'
            CreateALBLogSource: 'Yes'
            CreateALBS3Bucket: 'Yes'
            ALBS3BucketPathExpression: '/elasticloadbalancing/ap-south-1/*'
            ALBLogsSourceName: "test1env-alb-logs-ap-south-1"
            CreateCloudTrailLogSource: 'Yes'
            CreateCloudTrailBucket: 'Yes'
            CloudTrailBucketPathExpression: '/CloudTrail/ap-south-1/*'
            CloudTrailLogsSourceName: "test1env-cloudtrail-logs-ap-south-1"
            CreateCloudWatchLogSource: 'Yes'
            CloudWatchLogsSourceName: "test1env-cloudwatch-logs-ap-south-1"
          AutoEnableOptions:
            ALBAutoEnableS3Logs: 'Yes'
            ALBS3LogsBucketName: 'aws-observability-logs'
            AutoSubscribeLogGroups: 'Yes'
          AutoEnableOptions.AutoEnableS3LogsAlbAWSResources:
            BucketName: 'aws-observability-logs'
            AutoEnableResourceOptions: 'Both'
          AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources:
            UseExistingLogs: 'true'
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'Yes'
            Section3aCreateAwsInventorySource: 'Yes'
            Section3bAwsInventorySourceName: 'test1env-inventory-aws-ap-south-1'
            Section4aCreateAwsXRaySource: 'Yes'
            Section4bAwsXRaySourceName: 'test1env-xray-aws-ap-south-1'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: "*cloudtrail-logs*"
            Section6aCreateCloudWatchLogSource: 'No'
  - TestName: nothingtoinstall
    Regions:
      - us-east-1
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us2'
        Section1bSumoLogicAccessID: '${PROFESSIONAL_US2_ACCESS_ID}'
        Section1cSumoLogicAccessKey: '${PROFESSIONAL_US2_ACCESS_KEY}'
        Section1dSumoLogicOrganizationId: '${US2_PROFESSIONAL_ORG_ID}'
        Section2aAccountAlias: 'test2env'
        Section3aInstallObservabilityApps: 'No'
        Section4aCreateMetricsSourcesOptions: 'None'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'None'
        Section5bALBCreateLogSource: 'No'
        Section6aCreateCloudTrailLogSource: 'No'
        Section7aLambdaCreateCloudWatchLogsSource: 'No'
        Section8aCreateAwsXraySource: 'No'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoLambdaMetricsAppStack.LambdaMetricRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test2env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'No'
            CloudWatchMetricsSourceName: 'test2env-cloudwatch-metrics-us-east-1'
            CreateALBLogSource: 'No'
            CreateALBS3Bucket: 'No'
            ALBS3BucketPathExpression: ''
            ALBLogsSourceName: "test2env-alb-logs-us-east-1"
            CreateCloudTrailLogSource: 'No'
            CreateCloudTrailBucket: 'No'
            CloudTrailBucketPathExpression: ''
            CloudTrailLogsSourceName: "test2env-cloudtrail-logs-us-east-1"
            CreateCloudWatchLogSource: 'No'
            CloudWatchLogsSourceName: "test2env-cloudwatch-logs-us-east-1"
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'No'
            Section4aCreateAwsXRaySource: 'No'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: ""
            Section6aCreateCloudWatchLogSource: 'No'
  - TestName: nocloudtrailandinventory
    Regions:
      - us-east-2
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us2'
        Section1bSumoLogicAccessID: '${FREE_ACCOUNT_ACCESS_ID}'
        Section1cSumoLogicAccessKey: '${FREE_ACCOUNT_ACCESS_KEY}'
        Section1dSumoLogicOrganizationId: '${US2_FREE_ORG_ID}'
        Section2aAccountAlias: 'test3env'
        Section3aInstallObservabilityApps: 'Yes'
        Section4aCreateMetricsSourcesOptions: 'CloudWatchMetrics'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'New'
        Section5bALBCreateLogSource: 'Yes'
        Section6aCreateCloudTrailLogSource: 'No'
        Section7aLambdaCreateCloudWatchLogsSource: 'Yes'
        Section7cAutoSubscribeLogGroupsLambdaOptions: 'New'
        Section8aCreateAwsXraySource: 'Yes'
        Section4bMetricsNameSpaces: 'AWS/ElastiCache, AWS/ELB, AWS/NetworkELB, AWS/ApplicationELB, AWS/RDS'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - AutoEnableOptions
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - CreateCommonResources.CloudWatchMetricsFirstStack
            - CreateCommonResources.CloudWatchMetricsSecondStack
            - CreateCommonResources.CloudWatchMetricsFirstStack.FirstCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsFirstStack.FifthCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsSecondStack.SecondCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsSecondStack.ThirdCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsSecondStack.FourthCloudwatchMetricsSource
            - CreateCommonResources.ALBSource
            - CreateCommonResources.ALBSNSSubscription
            - CreateCommonResources.CloudWatchEventFunction
            - CreateCommonResources.CloudWatchHTTPSource
            - CreateCommonResources.CloudWatchEventFunction.SumoCWDeadLetterQueue
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEmailSNSTopic
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEventsInvokeLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaExecutionRole
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogGroup
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogSubsriptionFilter
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQScheduleRule
            - CreateCommonResources.CloudWatchEventFunction.SumoCWSpilloverAlarm
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsInvokePermission
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsRuleTrigger
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.SumoLambdaRole
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoCWLambdaInvokePermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTrigger
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTriggerPermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorRole
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoAlbMetricsAppStack.AlbLogsFieldExtractionRule
            - sumoLambdaMetricsAppStack.LambdaCloudWatchLogsFieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
            - CreateCommonResources.CloudWatchLambdaARN
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambdaArn
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test3env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'Yes'
            CloudWatchMetricsSourceName: 'test3env-cloudwatch-metrics-us-east-2'
            CreateALBLogSource: 'Yes'
            CreateALBS3Bucket: 'Yes'
            ALBS3BucketPathExpression: '/elasticloadbalancing/us-east-2/*'
            ALBLogsSourceName: "test3env-alb-logs-us-east-2"
            CreateCloudTrailLogSource: 'No'
            CreateCloudTrailBucket: 'No'
            CloudTrailBucketPathExpression: ''
            CloudTrailLogsSourceName: "test3env-cloudtrail-logs-us-east-2"
            CreateCloudWatchLogSource: 'Yes'
            CloudWatchLogsSourceName: "test3env-cloudwatch-logs-us-east-2"
          AutoEnableOptions:
            ALBAutoEnableS3Logs: 'Yes'
            ALBS3LogsBucketName: 'aws-observability-logs'
            AutoSubscribeLogGroups: 'Yes'
          AutoEnableOptions.AutoEnableS3LogsAlbAWSResources:
            BucketName: 'aws-observability-logs'
            AutoEnableResourceOptions: 'New'
          AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources:
            UseExistingLogs: 'false'
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'No'
            Section4aCreateAwsXRaySource: 'No'
            Section4bAwsXRaySourceName: 'test3env-xray-aws-us-east-2'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: ""
            Section6aCreateCloudWatchLogSource: 'No'
  - TestName: onlycloudtrailinventorysource
    Regions:
      - ap-south-1
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us1'
        Section1bSumoLogicAccessID: '${ENTERPRISE_US1_ACCESS_ID_1}'
        Section1cSumoLogicAccessKey: '${ENTERPRISE_US1_ACCESS_KEY_1}'
        Section1dSumoLogicOrganizationId: '${US1_ENTERPRISE_ORG_ID}'
        Section2aAccountAlias: 'test4env'
        Section3aInstallObservabilityApps: 'No'
        Section4aCreateMetricsSourcesOptions: 'InventorySource'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'New'
        Section5bALBCreateLogSource: 'No'
        Section6aCreateCloudTrailLogSource: 'Yes'
        Section7aLambdaCreateCloudWatchLogsSource: 'Yes'
        Section7cAutoSubscribeLogGroupsLambdaOptions: 'Existing'
        Section8aCreateAwsXraySource: 'No'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CommonCloudTrail
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - CreateCommonResources.CloudTrailSource
            - CreateCommonResources.CloudTrailSNSSubscription
            - CreateCommonResources.CloudWatchEventFunction
            - CreateCommonResources.CloudWatchHTTPSource
            - RootCauseAppStack.RootCauseRole
            - RootCauseAppStack.SumoLogicHostedCollector
            - RootCauseAppStack.InventorySource
            - CreateCommonResources.CloudWatchEventFunction.SumoCWDeadLetterQueue
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEmailSNSTopic
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEventsInvokeLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaExecutionRole
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogGroup
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogSubsriptionFilter
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQScheduleRule
            - CreateCommonResources.CloudWatchEventFunction.SumoCWSpilloverAlarm
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
            - sumoApiGatewayMetricsAppStack.FieldExtractionRule
            - sumoDynamoDBMetricsAppStack.FieldExtractionRule
            - sumoLambdaMetricsAppStack.LambdaCloudWatchLogsFieldExtractionRule
            - sumoRdsMetricsAppStack.FieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
            - CreateCommonResources.CloudWatchLambdaARN
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambdaArn
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test4env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'No'
            CloudWatchMetricsSourceName: 'test4env-cloudwatch-metrics-ap-south-1'
            CreateALBLogSource: 'No'
            CreateALBS3Bucket: 'No'
            ALBS3BucketPathExpression: ''
            ALBLogsSourceName: "test4env-alb-logs-ap-south-1"
            CreateCloudTrailLogSource: 'Yes'
            CreateCloudTrailBucket: 'Yes'
            CloudTrailBucketPathExpression: '/CloudTrail/ap-south-1/*'
            CloudTrailLogsSourceName: "test4env-cloudtrail-logs-ap-south-1"
            CreateCloudWatchLogSource: 'Yes'
            CloudWatchLogsSourceName: "test4env-cloudwatch-logs-ap-south-1"
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'Yes'
            Section3bAwsInventorySourceName: 'test4env-inventory-aws-ap-south-1'
            Section4aCreateAwsXRaySource: 'No'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: "*cloudtrail-logs*"
            Section6aCreateCloudWatchLogSource: 'No'
  - TestName: existingresourcetestcase1
    Regions:
      - us-east-1
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us2'
        Section1bSumoLogicAccessID: '${FREE_ACCOUNT_ACCESS_ID}'
        Section1cSumoLogicAccessKey: '${FREE_ACCOUNT_ACCESS_KEY}'
        Section1dSumoLogicOrganizationId: '${US2_FREE_ORG_ID}'
        Section2aAccountAlias: 'test5env'
        Section3aInstallObservabilityApps: 'No'
        Section4aCreateMetricsSourcesOptions: 'None'
        Section4cCloudWatchExistingSourceAPIUrl: 'https://api.us2.sumologic.com/api/v1/collectors/167776029/sources/841621157'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'Existing'
        Section5bALBCreateLogSource: 'Yes'
        Section5dALBS3LogsBucketName: 'cf-templates-1qpf3unpuo1hw-us-east-1'
        Section5eALBS3BucketPathExpression: '*abc*'
        Section6aCreateCloudTrailLogSource: 'Yes'
        Section7aLambdaCreateCloudWatchLogsSource: 'No'
        Section7bLambdaCloudWatchLogsSourceUrl: 'https://api.us2.sumologic.com/api/v1/collectors/167776029/sources/1169994000'
        Section7cAutoSubscribeLogGroupsLambdaOptions: 'Existing'
        Section8aCreateAwsXraySource: 'Yes'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - AutoEnableOptions
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CommonCloudTrail
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - CreateCommonResources.ALBSource
            - CreateCommonResources.ALBSNSTopic
            - CreateCommonResources.ALBSNSpolicy
            - CreateCommonResources.ALBSNSSubscription
            - CreateCommonResources.CloudTrailSource
            - CreateCommonResources.CloudTrailSNSSubscription
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.ExistingAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.SumoLambdaRole
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoAlbMetricsAppStack.SumoALBMetricsUpdateSource
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.SumoHTTPUpdateSource
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
            - sumoAlbMetricsAppStack.AlbLogsFieldExtractionRule
            - sumoApiGatewayMetricsAppStack.FieldExtractionRule
            - sumoDynamoDBMetricsAppStack.FieldExtractionRule
            - sumoLambdaMetricsAppStack.LambdaCloudWatchLogsFieldExtractionRule
            - sumoRdsMetricsAppStack.FieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - sumoLambdaMetricsAppStack.ExistingCloudWatchLogSourceName
            - sumoAlbMetricsAppStack.ExistingMetricSourceName
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test5env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'No'
            CloudWatchMetricsSourceName: 'test5env-cloudwatch-metrics-us-east-1'
            CreateALBLogSource: 'Yes'
            CreateALBS3Bucket: 'No'
            ALBS3BucketPathExpression: '/elasticloadbalancing/us-east-1/*'
            ALBS3LogsBucketName: 'cf-templates-1qpf3unpuo1hw-us-east-1'
            ALBLogsSourceName: "test5env-alb-logs-us-east-1"
            CreateCloudTrailLogSource: 'Yes'
            CreateCloudTrailBucket: 'Yes'
            CloudTrailBucketPathExpression: '/CloudTrail/us-east-1/*'
            CloudTrailLogsSourceName: "test5env-cloudtrail-logs-us-east-1"
            CreateCloudWatchLogSource: 'No'
            CloudWatchLogsSourceName: "test5env-cloudwatch-logs-us-east-1"
          AutoEnableOptions:
            ALBAutoEnableS3Logs: 'Yes'
            ALBS3LogsBucketName: 'cf-templates-1qpf3unpuo1hw-us-east-1'
            AutoSubscribeLogGroups: 'No'
          AutoEnableOptions.AutoEnableS3LogsAlbAWSResources:
            BucketName: 'cf-templates-1qpf3unpuo1hw-us-east-1'
            AutoEnableResourceOptions: 'Existing'
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
            Section4cCloudWatchExistingSourceAPIUrl: 'https://api.us2.sumologic.com/api/v1/collectors/167776029/sources/841621157'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'No'
            Section4aCreateAwsXRaySource: 'No'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: ""
            Section6aCreateCloudWatchLogSource: 'No'
            Section6cCloudWatchLogsAPIUrl: 'https://api.us2.sumologic.com/api/v1/collectors/167776029/sources/1169994000'
  - TestName: existingbuckets
    Regions:
      - us-east-2
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us1'
        Section1bSumoLogicAccessID: '${ENTERPRISE_US1_ACCESS_ID_2}'
        Section1cSumoLogicAccessKey: '${ENTERPRISE_US1_ACCESS_KEY_2}'
        Section1dSumoLogicOrganizationId: '${US1_ENTERPRISE_ORG_ID}'
        Section2aAccountAlias: 'test6env'
        Section3aInstallObservabilityApps: 'No'
        Section4aCreateMetricsSourcesOptions: 'Both'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'None'
        Section5bALBCreateLogSource: 'Yes'
        Section6aCreateCloudTrailLogSource: 'Yes'
        Section6cCloudTrailLogsBucketName: 'cf-templates-1qpf3unpuo1hw-us-east-2'
        Section6dCloudTrailBucketPathExpression: '*abc*'
        Section7aLambdaCreateCloudWatchLogsSource: 'No'
        Section8aCreateAwsXraySource: 'No'
        Section4bMetricsNameSpaces: 'AWS/ApiGateway, AWS/DynamoDB, AWS/ElastiCache'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - CreateCommonResources.CloudWatchMetricsFirstStack
            - CreateCommonResources.CloudWatchMetricsSecondStack
            - CreateCommonResources.CloudWatchMetricsFirstStack.SecondCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsFirstStack.ThirdCloudwatchMetricsSource
            - CreateCommonResources.CloudWatchMetricsSecondStack.SecondCloudwatchMetricsSource
            - CreateCommonResources.ALBSource
            - CreateCommonResources.ALBSNSSubscription
            - CreateCommonResources.CloudTrailSource
            - CreateCommonResources.CloudTrailSNSTopic
            - CreateCommonResources.CloudTrailSNSpolicy
            - CreateCommonResources.CloudTrailSNSSubscription
            - RootCauseAppStack.RootCauseRole
            - RootCauseAppStack.SumoLogicHostedCollector
            - RootCauseAppStack.InventorySource
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
            - sumoAlbMetricsAppStack.AlbLogsFieldExtractionRule
            - sumoApiGatewayMetricsAppStack.FieldExtractionRule
            - sumoDynamoDBMetricsAppStack.FieldExtractionRule
            - sumoRdsMetricsAppStack.FieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test6env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'Yes'
            CloudWatchMetricsSourceName: 'test6env-cloudwatch-metrics-us-east-2'
            CreateALBLogSource: 'Yes'
            CreateALBS3Bucket: 'Yes'
            ALBS3BucketPathExpression: '*AWSLogs/*/elasticloadbalancing/*'
            ALBLogsSourceName: "test6env-alb-logs-us-east-2"
            CreateCloudTrailLogSource: 'Yes'
            CreateCloudTrailBucket: 'No'
            CloudTrailLogsBucketName: 'cf-templates-1qpf3unpuo1hw-us-east-2'
            CloudTrailBucketPathExpression: '*abc*'
            CloudTrailLogsSourceName: "test6env-cloudtrail-logs-us-east-2"
            CreateCloudWatchLogSource: 'No'
            CloudWatchLogsSourceName: "test6env-cloudwatch-logs-us-east-2"
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'Yes'
            Section4aCreateAwsXRaySource: 'No'
            Section3bAwsInventorySourceName: 'test6env-inventory-aws-us-east-2'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'No'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: "*cloudtrail-logs*"
            Section6aCreateCloudWatchLogSource: 'No'
  - TestName: existingsourcestestcase2
    Regions:
      - ap-south-1
    Skip: false
    Parameters:
      Values:
        Section1aSumoLogicDeployment: 'us2'
        Section1bSumoLogicAccessID: '${PROFESSIONAL_US2_ACCESS_ID}'
        Section1cSumoLogicAccessKey: '${PROFESSIONAL_US2_ACCESS_KEY}'
        Section1dSumoLogicOrganizationId: '${US2_PROFESSIONAL_ORG_ID}'
        Section2aAccountAlias: 'test7env'
        Section3aInstallObservabilityApps: 'Yes'
        Section4aCreateMetricsSourcesOptions: 'InventorySource'
        Section5aAutoEnableS3LogsALBResourcesOptions: 'Both'
        Section5bALBCreateLogSource: 'No'
        Section5cALBLogsSourceUrl: 'https://api.us2.sumologic.com/api/v1/collectors/194268335/sources/1135631121'
        Section5dALBS3LogsBucketName: 'cf-templates-1qpf3unpuo1hw-ap-south-1'
        Section6aCreateCloudTrailLogSource: 'No'
        Section6bCloudTrailLogsSourceUrl: 'https://api.us2.sumologic.com/api/v1/collectors/194268335/sources/1135631970'
        Section7aLambdaCreateCloudWatchLogsSource: 'No'
        Section8aCreateAwsXraySource: 'Yes'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - CreateCommonResources
            - AutoEnableOptions
            - sumoEC2MetricsAppStack
            - sumoAlbMetricsAppStack
            - sumoDynamoDBMetricsAppStack
            - sumoRdsMetricsAppStack
            - sumoApiGatewayMetricsAppStack
            - RootCauseAppStack
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.AccountCheck
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.LambdaToDecideCWMetricsSources
            - CreateCommonResources.Primerinvoke
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsInvokePermission
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsRuleTrigger
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.ExistingAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.SumoLambdaRole
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoEC2MetricsAppStack.sumoApp
            - sumoEC2MetricsAppStack.sumoOverview
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoAlbMetricsAppStack.sumoApp
            - sumoAlbMetricsAppStack.SumoALBLogsUpdateSource
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoDynamoDBMetricsAppStack.sumoApp
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.sumoApp
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoApiGatewayMetricsAppStack.sumoApp
            - sumoLambdaMetricsAppStack.sumoApp
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.SumoCloudTrailLogsUpdateSource
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
            - sumoAlbMetricsAppStack.AlbLogsFieldExtractionRule
            - sumoApiGatewayMetricsAppStack.FieldExtractionRule
            - sumoDynamoDBMetricsAppStack.FieldExtractionRule
            - sumoRdsMetricsAppStack.FieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.EnterpriseCheck
            - CreateCommonResources.PaidAccountCheck
            - CreateCommonResources.Namespaces
            - CreateCommonResources.LambdaRoleARN
            - sumoLambdaMetricsAppStack.ExistingCloudTrailLogSourceName
            - sumoAlbMetricsAppStack.ExistingLogSourceName
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-test7env"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'No'
            CloudWatchMetricsSourceName: 'test7env-cloudwatch-metrics-ap-south-1'
            CreateALBLogSource: 'No'
            CreateALBS3Bucket: 'No'
            ALBS3BucketPathExpression: '/elasticloadbalancing/ap-south-1/*'
            ALBLogsSourceName: "test7env-alb-logs-ap-south-1"
            CreateCloudTrailLogSource: 'No'
            CreateCloudTrailBucket: 'No'
            CloudTrailBucketPathExpression: 'AWSLogs/*/CloudTrail/*'
            CloudTrailLogsSourceName: "test7env-cloudtrail-logs-ap-south-1"
            CreateCloudWatchLogSource: 'No'
            CloudWatchLogsSourceName: "test7env-cloudwatch-logs-ap-south-1"
          AutoEnableOptions:
            ALBAutoEnableS3Logs: 'Yes'
            ALBS3LogsBucketName: 'cf-templates-1qpf3unpuo1hw-ap-south-1'
            AutoSubscribeLogGroups: 'No'
          AutoEnableOptions.AutoEnableS3LogsAlbAWSResources:
            BucketName: 'cf-templates-1qpf3unpuo1hw-ap-south-1'
            AutoEnableResourceOptions: 'Both'
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
            Section5fALBLogsAPIUrl: 'https://api.us2.sumologic.com/api/v1/collectors/194268335/sources/1135631121'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          RootCauseAppStack:
            Section2aInstallApp: 'No'
            Section3aCreateAwsInventorySource: 'No'
            Section4aCreateAwsXRaySource: 'No'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: ""
            Section6aCreateCloudWatchLogSource: 'No'
            Section5fCloudTrailLogsAPIUrl: 'https://api.us2.sumologic.com/api/v1/collectors/194268335/sources/1135631970'