---
Global:
  TemplatePath: "../sumologic_observability.master.template.yaml"
  TestProjectName: BasicTestProject
  ParallelTestsRun: 8
  GlobalParameters:
    Section1aSumoLogicDeployment: ''
    Section1bSumoLogicAccessID: ''
    Section1cSumoLogicAccessKey: ''
    Section1dSumoLogicOrganizationId: ''
    Section1eSumoLogicResourceRemoveOnDeleteStack: 'true'
    Section2aAccountAlias: 'TestEnv'
Tests:
  - TestName: defaultparameters
    Regions:
      - ap-south-1
    Skip: false
    Parameters:
      Values:
        Section2aAccountAlias: 'TestEnv'
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - WaitHandle
            - CreateCommonResources
            - sumoOverview
            - AutoEnableOptions
            - sumoEC2MetricsAppStack
            - ALBWaitHandle
            - ALBWaitCondition
            - sumoAlbMetricsAppStack
            - DynamoDBWaitHandle
            - DynamoDBWaitCondition
            - sumoDynamoDBMetricsAppStack
            - RDSWaitHandle
            - RDSWaitCondition
            - sumoRdsMetricsAppStack
            - ApiWaitHandle
            - ApiWaitCondition
            - sumoApiGatewayMetricsAppStack
            - AnamolyWaitHandle
            - AnamolyWaitCondition
            - AnamolyAppStack
            - LambdaWaitHandle
            - LambdaWaitCondition
            - sumoLambdaMetricsAppStack
            - AddAccountField
            - AddEntityField
            - CreateCommonResources.WaitHandle
            - CreateCommonResources.LambdaRole
            - CreateCommonResources.LambdaHelper
            - CreateCommonResources.CommonBucketSNSTopic
            - CreateCommonResources.CommonS3Bucket
            - CreateCommonResources.CommonBucketPolicy
            - CreateCommonResources.CommonSNSpolicy
            - CreateCommonResources.CommonCloudTrail
            - CreateCommonResources.CreateSumoLogicAWSExplorerView
            - CreateCommonResources.SumoLogicSourceRole
            - CreateCommonResources.SumoLogicHostedCollector
            - CreateCommonResources.SumoLogicCloudwatchMetricsSourceWaitCondition
            - CreateCommonResources.SumoLogicCloudwatchMetricsSource
            - CreateCommonResources.ALBSourceWaitCondition
            - CreateCommonResources.ALBSource
            - CreateCommonResources.ALBSNSSubscription
            - CreateCommonResources.CloudTrailSourceWaitCondition
            - CreateCommonResources.CloudTrailSource
            - CreateCommonResources.CloudTrailSNSSubscription
            - CreateCommonResources.CloudWatchHTTPSourceWaitCondition
            - CreateCommonResources.CloudWatchEventFunction
            - CreateCommonResources.CloudWatchHTTPSource
            - CreateCommonResources.InventorySourceWaitCondition
            - CreateCommonResources.InventoryRole
            - CreateCommonResources.InventorySource
            - CreateCommonResources.CloudWatchEventFunction.SumoCWDeadLetterQueue
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEmailSNSTopic
            - CreateCommonResources.CloudWatchEventFunction.SumoCWEventsInvokeLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaExecutionRole
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLambdaPermission
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogGroup
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogSubsriptionFilter
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQLambda
            - CreateCommonResources.CloudWatchEventFunction.SumoCWProcessDLQScheduleRule
            - CreateCommonResources.CloudWatchEventFunction.SumoCWSpilloverAlarm
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsInvokePermission
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.AutoEnableAlbLogEventsRuleTrigger
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.ExistingAWSResources
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.SumoLambdaRole
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoCWLambdaInvokePermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTrigger
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorLambdaTriggerPermission
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnectorRole
            - sumoEC2MetricsAppStack.EC2MetricRule
            - sumoEC2MetricsAppStack.sumoApp
            - sumoAlbMetricsAppStack.WaitHandle
            - sumoAlbMetricsAppStack.ALBMetricRule
            - sumoAlbMetricsAppStack.sumoApp
            - sumoAlbMetricsAppStack.ALBUpdateSourceWaitCondition
            - sumoDynamoDBMetricsAppStack.WaitHandle
            - sumoDynamoDBMetricsAppStack.MetricRule
            - sumoDynamoDBMetricsAppStack.sumoApp
            - sumoDynamoDBMetricsAppStack.UpdateSourceWaitCondition
            - sumoRdsMetricsAppStack.WaitHandle
            - sumoRdsMetricsAppStack.ClusterMetricRule
            - sumoRdsMetricsAppStack.InstanceMetricRule
            - sumoRdsMetricsAppStack.sumoApp
            - sumoRdsMetricsAppStack.UpdateSourceWaitCondition
            - sumoApiGatewayMetricsAppStack.WaitHandle
            - sumoApiGatewayMetricsAppStack.MetricRule
            - sumoApiGatewayMetricsAppStack.sumoApp
            - sumoApiGatewayMetricsAppStack.UpdateSourceWaitCondition
            - AnamolyAppStack.sumoOverview
            - sumoLambdaMetricsAppStack.WaitHandle
            - sumoLambdaMetricsAppStack.LambdaMetricRule
            - sumoLambdaMetricsAppStack.sumoApp
            - sumoLambdaMetricsAppStack.UpdateSourceWaitCondition
            - sumoLambdaMetricsAppStack.FERWaitCondition
            - sumoLambdaMetricsAppStack.LambdaFieldExtractionRule
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CreateCommonResources.LambdaHelperARN
            - CreateCommonResources.LambdaRoleARN
            - CreateCommonResources.BucketName
            - CreateCommonResources.CloudWatchLambdaARN
            - CreateCommonResources.CloudWatchEventFunction.SumoCWLogsLambdaArn
            - AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources.SumoLogGroupLambdaConnector
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableExisitngAWSResourcesLambda
            - AutoEnableOptions.AutoEnableS3LogsAlbAWSResources.EnableNewAWSResourcesLambda
      - AssertType: ParameterCheck
        Assert:
          CreateCommonResources:
            CollectorName: "aws-observability-collector"
            CreateMetaDataSource: 'No'
            CreateCloudWatchMetricsSource:  'Yes'
            CloudWatchMetricsSourceName: 'TestEnv-cloudwatch-metrics-ap-south-1'
            CreateALBLogSource: 'Yes'
            CreateALBS3Bucket: 'Yes'
            ALBS3BucketPathExpression: '/elasticloadbalancing/ap-south-1/*'
            ALBLogsSourceName: "TestEnv-alb-logs-ap-south-1"
            CreateCloudTrailLogSource: 'Yes'
            CreateCloudTrailBucket: 'Yes'
            CloudTrailBucketPathExpression: '/CloudTrail/ap-south-1/*'
            CloudTrailLogsSourceName: "TestEnv-cloudtrail-logs-ap-south-1"
            CreateCloudWatchLogSource: 'Yes'
            CloudWatchLogsSourceName: "TestEnv-cloudwatch-logs-ap-south-1"
            CreateAwsInventorySource: 'Yes'
            AwsInventorySourceName: "TestEnv-inventory-ap-south-1"
          AutoEnableOptions:
            ALBAutoEnableS3Logs: 'Yes'
            ALBS3LogsBucketName: 'aws-observability-logs'
            AutoSubscribeLogGroups: 'Yes'
          AutoEnableOptions.AutoEnableS3LogsAlbAWSResources:
            BucketName: 'aws-observability-logs'
            AutoEnableResourceOptions: 'Both'
          AutoEnableOptions.AutoSubscribeLambdaLogGroupsAWSResources:
            UseExistingLogs: 'true'
          sumoEC2MetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateMetaDataSource: 'No'
          sumoAlbMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateS3Bucket: 'No'
            Section5cCreateALBLogSource: 'No'
          sumoDynamoDBMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoRdsMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          sumoApiGatewayMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
          AnamolyAppStack:
            Section2aInstallApp: 'Yes'
            Section3aCreateAwsInventorySource: 'No'
          sumoLambdaMetricsAppStack:
            Section2aTagExistingAWSResources: 'No'
            Section3aInstallApp: 'Yes'
            Section4aCreateCloudWatchMetricsSource: 'No'
            Section5aCreateCloudTrailBucket: 'No'
            Section5cCreateCloudTrailLogSource: 'No'
            Section5eCloudTrailLogsSourceName: "*cloudtrail-logs*"
            Section6aCreateCloudWatchLogSource: 'No'